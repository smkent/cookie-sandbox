---
name: Update Dependencies

on:
  workflow_dispatch:

jobs:
  Update:
    name: Check for updates

    runs-on: ubuntu-latest

    steps:
      - name: 💾 Check out repository
        uses: actions/checkout@v3

      - name: 🐍 Build and test Python project with Poetry
        uses: ./.github/workflows/actions/python-poetry
        with:
          update: true

      - name: 🔬 Check if any dependencies were updated
        run: |
          echo "updated_files=$(git status --porcelain | wc -l)" >> $GITHUB_ENV

      - name: ⚙️ Create pull request
        run: |
          echo updated_files=${updated_files}
          gh pr create -B main -H dependency-updates \
            --title 'Update project dependencies' \
            --body "$(cat ${{ runner.temp }}/poetry_updates.txt)"
        if: ${{ env.updated_files > 0 }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
